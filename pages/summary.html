<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Winter Classic â€“ Player Summary</title>

<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- Table sorting library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>

<style>
    body { background-color: #f2f6fc; }

    /* Header bar (matches Winter Classic style) */
    .wc-header {
        background-color: #003366;
        padding: 10px 20px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .wc-header img {
        height: 50px;
    }
    .back-button {
        color: white;
        font-weight: bold;
        text-decoration: none;
        font-size: 1.1rem;
    }
    .back-button:hover {
        color: #cce0ff;
    }

    h1 {
        margin: 25px 0;
        text-align: center;
        font-weight: 600;
        color: #003366;
    }

    table { background: white; }
    .modal-content { border-radius: 10px; }

    .player-link {
        cursor: pointer;
        color: #0d6efd;
        font-weight: 600;
    }
    .player-link:hover { text-decoration: underline; }
</style>
</head>

<body>

<!-- Winter Classic Header -->
<div class="wc-header">
    <a href="../golf.html" class="back-button">&larr; Back</a>
    <img src="../assets/logo.png" alt="Winter Classic Logo">
</div>

<h1>Player Summary</h1>

<div class="container">
<div class="table-responsive">
<table id="summaryTable" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Player</th>
            <th>Total Matches</th>
            <th>Total Winnings</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>
</div>

<!-- Modal -->
<div class="modal fade" id="playerModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="playerModalLabel">Player Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <table class="table table-sm table-striped">
          <thead>
            <tr>
              <th>Page</th>
              <th>Result</th>
              <th>Winnings</th>
            </tr>
          </thead>
          <tbody id="modalTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
let playerData = {};

function loadCSV() {
    Papa.parse("../assets/player_match_results.csv", {
        download: true,
        header: true,
        complete: function(results) {
            processData(results.data);
        }
    });
}

function processData(data) {
    playerData = {};

    data.forEach(row => {
        const player = row.player;
        if (!player) return;

        if (!playerData[player]) {
            playerData[player] = {
                matches: 0,
                totalMoney: 0,
                details: []
            };
        }

        playerData[player].matches++;

        // Determine win/loss flags (case-insensitive)
        let winFlag  = (row.Winner || "").trim().toUpperCase() === "X";
        let lossFlag = (row.Loser  || "").trim().toUpperCase() === "X";
        
        let result = "N/A";
        if (winFlag) result = "Win";
        else if (lossFlag) result = "Loss";
        
        // Only add winnings for WINNERS
        let money = 0;
        if (winFlag && row.Winnings && row.Winnings.trim().startsWith("$")) {
            money = parseFloat(row.Winnings.replace("$", "").trim());
            playerData[player].totalMoney += money;
        }


        playerData[player].details.push({
            page: row.page,
            result: result,
            winnings: row.Winnings
        });
    });

    buildTable();
}

function buildTable() {
    const tbody = document.querySelector("#summaryTable tbody");
    tbody.innerHTML = "";

    Object.keys(playerData).sort().forEach(player => {
        const p = playerData[player];

        const row = document.createElement("tr");
        row.innerHTML = `
            <td><span class="player-link" onclick="openModal('${player}')">${player}</span></td>
            <td>${p.matches}</td>
            <td>$${p.totalMoney}</td>
        `;
        tbody.appendChild(row);
    });

    new Tablesort(document.getElementById("summaryTable"));
}

function openModal(player) {
    const modalLabel = document.getElementById("playerModalLabel");
    const modalBody = document.getElementById("modalTableBody");

    modalLabel.textContent = player;
    modalBody.innerHTML = "";

    playerData[player].details.forEach(d => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${d.page}</td>
            <td>${d.result}</td>
            <td>${d.winnings}</td>
        `;
        modalBody.appendChild(row);
    });

    const modal = new bootstrap.Modal(document.getElementById('playerModal'));
    modal.show();
}

loadCSV();
</script>

</body>
</html>
